{% extends 'base.html' %}

{% block content %}
    <h2>Homepage</h2>

    <!-- Post Form -->
    <div style="color: red; background-color: aqua;">
        <text type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#postModal">
            Add Post
        </text>

        <!-- Modal -->
        <div class="modal fade" id="postModal" tabindex="-1" aria-labelledby="postModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="postModalLabel">Create a New Post</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form method="POST">
                            {% csrf_token %}
                            {{ form.as_p }}
                            <button type="submit" name="create_post" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Display Posts -->
    <div>
        <h3>Recent Posts</h3>

        {% if posts %}
            {% for post_data in posts %}
                <div class="post" style="background-color: antiquewhite; margin-bottom: 10px; padding: 10px; color: brown;">
                    <h3>{{ post_data.post.title }}</h3>

                    <!-- Display the caption/content of the post -->
                    <p>{{ post_data.post.caption.content }}</p>

                    <!-- Show image if the post has one -->
                    {% if post_data.post.image_or_video_url %}
                        <img src="{{ post_data.post.image_or_video_url }}" alt="Post Image" class="post-image">
                    {% endif %}

                    <!-- Show the category of the post -->
                    <p>Category: {{ post_data.post.category }}</p>

                    <!-- Show the time the post was created -->
                    <p>Posted on: {{ post_data.post.when_posted|date:"F j, Y, g:i a" }}</p>

                    <!-- Link to the user's profile -->
                    <p>Posted by: <a href="{% url 'profile' username=post_data.post.user.username %}">{{ post_data.post.user.username }}</a></p>

                    <!-- Link to the Post Detail Page -->
                    <a href="{% url 'post_detail' post_data.post.post_id %}" class="btn btn-secondary">View Post</a>

                    <!-- Like Button -->
                    {% if request.user != post_data.post.user %}
                        {% if post_data.liked_by_user %}
                            <button class="btn btn-warning" disabled>Liked</button>
                        {% else %}
                            <form method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="post_id" value="{{ post_data.post.post_id }}">
                                <button type="submit" name="add_like" class="btn btn-primary">Like</button>
                            </form>
                        {% endif %}
                    {% endif %}

                    <!-- Link to Likes List -->
                    <p>
                        <a href="{% url 'post_likes' post_data.post.post_id %}">
                            Likes: {{ post_data.post.likes.count }}
                        </a>
                    </p>

                    <!-- Comment Form -->
                    <form method="POST">
                        {% csrf_token %}
                        <input type="text" name="content" placeholder="Add a comment" required>
                        <button type="submit" name="create_comment" class="btn btn-primary">Add Comment</button>
                        <input type="hidden" name="post_id" value="{{ post_data.post.post_id }}">
                    </form>

                    <!-- Display comments -->
                    <div>
                        <h4>Comments:</h4>
                        {% if post_data.comments %}
                            {% for comment in post_data.comments %}
                                <p>{{ comment.content }} by {{ comment.user.username }}</p>
                            {% endfor %}
                        {% else %}
                            <p>No comments yet.</p>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>No posts available.</p>
        {% endif %}
    </div>

    <!-- Pagination -->
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>

{% endblock %}
